#!/bin/bash

# This script is a docker-compose wrapper in case of more than one
# compose setting files.
# This works in the git repository and repository have a `.compose-file`
# on the git's root directory.

# A example of the `.compose-file`:
#   docker-compose.yml
#   docker-compose.dev.yml

# if in a git project
if git rev-parse --is-inside-work-tree > /dev/null 2>&1; then
  git_root_dir="$(pwd)/$(git rev-parse --show-cdup)"
  git_root_dir="${git_root_dir%/}"
  setting_file_path="$git_root_dir/.compose-file"
  if [ -f "$setting_file_path" ]; then
    compose_files=""
    for compose_file in $(cat $setting_file_path); do
      compose_files="$compose_files:$git_root_dir/$compose_file"
    done
    compose_files="${compose_files#:}"
  else
    compose_files="$git_root_dir/docker-compose.yml"
  fi
  COMPOSE_FILE="$compose_files" docker-compose $*

# if no git project
else
  command docker-compose $*

fi
